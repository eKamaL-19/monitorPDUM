<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
    <title>Monitoring Tarik Data Siswa Madrasah</title>
	<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,
		%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E
		%3Cdefs%3E
		%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E
		%3Cstop offset='0%25' stop-color='%234f46e5'/%3E
		%3Cstop offset='100%25' stop-color='%237c3aed'/%3E
		%3C/linearGradient%3E
		%3C/defs%3E
		%3Crect width='64' height='64' rx='14' fill='url(%23g)'/%3E
		%3Cpath d='M32 10a22 22 0 1 0 22 22h-6a16 16 0 1 1-16-16z' fill='white'/%3E
		%3Ccircle cx='32' cy='32' r='4' fill='white'/%3E
		%3Cline x1='32' y1='32' x2='48' y2='48' stroke='white' stroke-width='4' stroke-linecap='round'/%3E
		%3C/svg%3E">
    <meta name="description" content="Dashboard monitoring progres penarikan data siswa madrasah" />

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css" rel="stylesheet" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />

    <style>
	:root{--a:linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%);--b:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05);--c:#f3f4f6;--d:#1f2937;--e:#10b981;--f:#f59e0b;--g:#ef4444;--h:#035c41}*{box-sizing:border-box}body,html{height:100%;margin:0;padding:0}body{background:var(--c);color:var(--d);display:flex;flex-direction:column;font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh}.splash-screen{align-items:center;animation:i 12s ease infinite;background:linear-gradient(-45deg,#4f46e5,#06b6d4,#10b981,#3b82f6);background-size:400% 400%;display:flex;inset:0;justify-content:center;position:fixed;transition:opacity .6s ease,visibility .6s ease;z-index:99999}@keyframes i{0%{background-position:0 50%}50%{background-position:100% 50%}to{background-position:0 50%}}.splash-screen.hidden{opacity:0;visibility:hidden}.splash-content{background:rgba(255,255,255,.08);backdrop-filter:blur(12px);border-radius:20px;box-shadow:0 20px 50px rgba(0,0,0,.25);color:#fff;max-width:420px;padding:30px;text-align:center;width:100%}.splash-logo{animation:j 1.5s infinite;font-size:50px;margin-bottom:20px}@keyframes j{0%{opacity:1;transform:scale(1)}50%{opacity:.85;transform:scale(1.08)}to{opacity:1;transform:scale(1)}}.splash-title{font-size:1.4rem;font-weight:700;margin-bottom:5px}.splash-subtitle{font-size:.85rem;margin-bottom:25px;opacity:.7}.splash-progress{background:rgba(255,255,255,.15);border-radius:4px;height:6px;overflow:hidden;width:100%}.splash-progress-bar{animation:k 2s linear infinite;background:linear-gradient(90deg,#fff,#a5f3fc,#fff);background-size:200% 100%;height:100%;transition:width .3s ease;width:0%}@keyframes k{0%{background-position:200% 0}to{background-position:-200% 0}}.splash-loading-text{font-size:.75rem;margin-top:12px;opacity:.6}.header-section{background:var(--a);border-bottom-left-radius:2rem;border-bottom-right-radius:2rem;color:#fff;flex-shrink:0;margin-bottom:-1.5rem;padding:1.5rem 1rem 2rem;position:relative;z-index:1}.header-title{font-size:clamp(1.3rem,3.5vw,1.6rem);font-weight:800;letter-spacing:-.025em;line-height:1.1;margin-bottom:.5rem}.header-subtitle{font-size:clamp(1rem,2.2vw,1.15rem);font-weight:600;line-height:1.2;margin-bottom:.5rem;opacity:.95}.main-container{display:flex;flex:1;flex-direction:column;max-width:100%;overflow-x:hidden;padding:0 1rem;position:relative;width:100%;z-index:2}.custom-card{background:#fff;border:none;border-radius:1rem;box-shadow:var(--b);display:flex;flex-direction:column;height:100%;overflow:hidden;transition:transform .2s,box-shadow .2s}.custom-card:hover{box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04);transform:translateY(-4px)}.bg-icon-ra{background:#fee2e2;color:#ef4444}.bg-icon-mi{background:#e0e7ff;color:#4f46e5}.bg-icon-mts{background:#dcfce7;color:#10b981}.bg-icon-ma{background:#fef3c7;color:#f59e0b}.stat-icon{align-items:center;border-radius:12px;display:flex;font-size:1.25rem;height:48px;justify-content:center;margin-bottom:1rem;width:48px}.progress-micro{background:#f3f4f6;border-radius:4px;height:8px;margin-top:auto;overflow:hidden}.progress-bar-animated{animation:l 1.5s ease-out forwards}@keyframes l{0%{width:0%}}.chart-container{display:flex;flex-direction:column;min-height:280px;padding:15px;position:relative;width:100%}.chart-header{align-items:center;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;margin-bottom:15px;padding-bottom:10px}.chart-title{color:#374151;font-size:1rem;font-weight:600;margin:0}.chart-wrapper{flex:1;min-height:200px;padding:5px;position:relative;width:100%}#kecamatanTableContainer,#overallChartContainer,#validasiChartContainer{display:flex;flex-direction:column;height:375px}#overallChartContainer .chart-header,#validasiChartContainer .chart-header{min-height:80px}#overallChartContainer .chart-wrapper,#validasiChartContainer .chart-wrapper{flex:1;height:220px;max-height:220px;padding:0}#kecamatanTableContainer{min-height:375px}.kecamatan-table-container{display:flex;flex:1;flex-direction:column;height:calc(100% - 50px);overflow:auto;padding:8px 4px}.kecamatan-grid{display:grid;gap:8px;grid-template-columns:repeat(3,1fr);margin-bottom:15px;width:100%}.kecamatan-item{background:#fff;border:1px solid transparent;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.07);display:flex;flex-direction:column;min-height:90px;overflow:hidden;padding:10px;position:relative;transition:all .2s ease}.kecamatan-item:hover{border-color:#e5e7eb;box-shadow:0 8px 16px rgba(0,0,0,.12);transform:translateY(-3px)}.kecamatan-item.bg-high{background:linear-gradient(135deg,rgba(16,185,129,.08),rgba(5,150,105,.05));border-color:rgba(16,185,129,.2)}.kecamatan-item.bg-medium{background:linear-gradient(135deg,rgba(245,158,11,.08),rgba(217,119,6,.05));border-color:rgba(245,158,11,.2)}.kecamatan-item.bg-low{background:linear-gradient(135deg,rgba(239,68,68,.08),rgba(220,38,38,.05));border-color:rgba(239,68,68,.2)}.kecamatan-item.bg-complete{background:linear-gradient(135deg,rgba(16,185,129,.12),rgba(5,150,105,.08));border-color:rgba(5,150,105,.3)}.kecamatan-row{align-items:flex-start;display:flex;justify-content:space-between;margin-bottom:6px;width:100%}.kecamatan-left{flex:1;min-width:0;padding-right:5px}.kecamatan-name{font-size:.85rem;font-weight:700;line-height:1.2;margin-bottom:3px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.kecamatan-count{color:#6b7280;font-size:.8rem;font-weight:500;white-space:nowrap}.kecamatan-right{align-items:flex-end;display:flex;flex-direction:column;margin-left:5px}.kecamatan-percent{border-radius:15px;box-shadow:0 1px 3px rgba(0,0,0,.15);color:#fff;font-size:.9rem;font-weight:700;margin-bottom:4px;min-width:50px;padding:3px 8px;text-align:center}.percent-high{background:linear-gradient(135deg,var(--e),#035c41)}.percent-medium{background:linear-gradient(135deg,var(--f),#d97706)}.percent-low{background:linear-gradient(135deg,var(--g),#dc2626)}.percent-complete{background:linear-gradient(135deg,var(--e),var(--h))}.kecamatan-progress-container{background:rgba(0,0,0,.08);border-radius:2.5px;height:5px;margin-top:4px;overflow:hidden;width:100%}.kecamatan-progress-bar{border-radius:3px;height:100%;transition:width 1s ease-in-out}.table-card{background:#fff;border:1px solid rgba(0,0,0,.05);border-radius:1.5rem;box-shadow:var(--b);flex-shrink:0;margin-top:2rem;overflow:hidden;padding:1.5rem;width:100%}.filter-box{background:#f9fafb;border:1px solid #e5e7eb;border-radius:1rem;margin-bottom:1.5rem;padding:1.25rem;width:100%}.badge-custom{border-radius:6px;font-size:.75rem;font-weight:600;letter-spacing:.025em;padding:.5em .8em;white-space:nowrap}.badge-sukses{background:#dcfce7;color:#166534}.badge-belum{background:#fee2e2;color:#991b1b}.text-status-sukses{color:#198754!important;font-weight:700}.text-status-belum{color:#dc3545!important;font-weight:700}table.dataTable thead th{background:var(--a)!important;background-color:#4f46e5!important;border-bottom:none!important;color:#fff!important;font-size:.85rem;font-weight:700!important;letter-spacing:.05em;padding:14px 8px!important;text-align:center!important;text-transform:uppercase;vertical-align:middle;white-space:nowrap}table.dataTable thead th:first-child{border-bottom-left-radius:10px;border-top-left-radius:10px}table.dataTable thead th:last-child{border-bottom-right-radius:10px;border-top-right-radius:10px}table.dataTable tbody td{border-bottom:1px solid #f3f4f6;padding:12px 8px;text-align:center;vertical-align:middle}table.dataTable tbody td:nth-child(2),table.dataTable tbody td:nth-child(3){text-align:left!important}.badge-validasi{border-radius:6px;font-size:.75rem;font-weight:600;letter-spacing:.025em;padding:.4em .8em}.badge-valid{background:#d1fae5;border:1px solid #a7f3d0;color:#065f46}.badge-invalid{background:#fee2e2;border:1px solid #fecaca;color:#991b1b}.badge-pending{background:#fef3c7;border:1px solid #fde68a;color:#92400e}.dt-buttons{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:10px}.dt-buttons .btn{border:none;border-radius:8px!important;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);font-size:.85rem;font-weight:500;white-space:nowrap}.btn-dt-excel{background:#10b981;color:#fff}.btn-dt-pdf{background:#ef4444;color:#fff}.btn-dt-print{background:#6366f1;color:#fff}.footer{background:#fff;border-top:1px solid #e5e7eb;color:#6b7280;flex-shrink:0;font-size:.875rem;margin-top:auto;padding:1.5rem 1rem;text-align:center}.dt-grid-container{align-items:center;display:grid;gap:20px;grid-template-areas:"left center right";grid-template-columns:1fr auto 1fr;margin-bottom:1rem;width:100%}.dt-grid-item-left{grid-area:left;justify-self:start}.dt-grid-item-center{grid-area:center;justify-self:center;max-width:400px;min-width:300px;width:100%}.dt-grid-item-right{grid-area:right;justify-self:end}.dataTables_filter{width:100%}.dataTables_filter label{display:flex;justify-content:center;width:100%}.dataTables_filter input{width:100%!important}.saas-filter{background:linear-gradient(135deg,#fff,#f8f9ff);border:1px solid rgba(79,70,229,.08);border-radius:20px;box-shadow:0 20px 40px rgba(79,70,229,.06),inset 0 1px 0 rgba(255,255,255,.6)}.saas-filter-row{align-items:center;display:flex;gap:16px}.saas-item{flex:1}.saas-select{border:1px solid transparent;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.05);color:#1f2937;font-size:.9rem;font-weight:500;height:46px;padding:0 14px;transition:all .25s ease;width:100%}.gradient-jenjang{background:linear-gradient(135deg,#fff,#eef2ff);border-color:rgba(79,70,229,.25)}.gradient-status{background:linear-gradient(135deg,#fff,#ecfdf5);border-color:rgba(16,185,129,.25)}.gradient-alamat{background:linear-gradient(135deg,#fff,#eff6ff);border-color:rgba(59,130,246,.25)}.gradient-validasi{background:linear-gradient(135deg,#fff,#fffbeb);border-color:rgba(245,158,11,.25)}.saas-reset-danger{align-items:center;background:#fee2e2;border:1px solid #fecaca;border-radius:12px;color:#dc2626;display:flex;font-size:.9rem;font-weight:600;gap:6px;height:44px;justify-content:center;padding:0 18px;transition:all .2s ease}.saas-reset-danger:hover{background:#dc2626;border-color:#dc2626;box-shadow:0 8px 18px rgba(220,38,38,.25);color:#fff;transform:translateY(-2px)}@media (max-width:1200px){.kecamatan-grid{grid-template-columns:repeat(2,1fr)}}@media (max-width:1024px){.kecamatan-item{padding:9px;min-height:88px}.kecamatan-name{font-size:.83rem}}@media (max-width:992px){.header-section{padding:2rem 1rem 3rem;margin-bottom:-2rem}.dt-grid-container{grid-template-columns:1fr;grid-template-areas:"left" "right" "center"}}@media (max-width:768px){.kecamatan-grid{grid-template-columns:repeat(2,1fr)}.kecamatan-item{padding:8px;min-height:85px}.kecamatan-name{white-space:normal;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.kecamatan-progress-container{height:4px}}@media (max-width:576px){.kecamatan-grid{grid-template-columns:1fr}}
    </style>
</head>

<body>

	<!-- SPLASH SCREEN -->
	<div id="splashScreen" class="splash-screen">
		<div class="splash-content">

			<div class="splash-logo">
				<i class="fas fa-satellite-dish"></i>
			</div>

			<h1 class="splash-title">MONITOR EMIS PDUM</h1>
			<p class="splash-subtitle">KEMENAG KABUPATEN SUMENEP</p>

			<div class="splash-progress">
				<div class="splash-progress-bar" id="splashBar"></div>
			</div>

			<small class="splash-loading-text">
				Menghubungkan ke sistem...
			</small>

		</div>
	</div>

	
	<!-- MODAL PESAN CUT OFF -->
	<div class="modal fade" id="cutoffModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content border-0 shadow-lg">
			  <div class="modal-header bg-danger text-white">
				<h5 class="modal-title fw-bold">
				  ⛔ INFORMASI CUT OFF ⛔
				</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
			  </div>

			  <div class="modal-body text-center">
				<div class="fw-bold text-danger fs-5 mb-2">
				  CUT OFF 31 JANUARI 2026
				</div>

				<div class="fw-bold text-muted mb-1">
				  Sisa Waktu:
				</div>

				<div id="countdownCutoff" class="fw-bold fs-4 text-dark">
				  Menghitung...
				</div>
				<hr>
				<div class="text-center text-muted mt-2">
				  Pastikan seluruh data telah ditarik dan divalidasi sebelum batas waktu cut off.
				</div>
			  </div>
				<!-- Progress Auto Close -->
				<div class="mt-3">
				  <div class="progress" style="height: 6px;">
					<div
					  id="cutoffProgress"
					  class="progress-bar bg-danger progress-bar-striped progress-bar-animated"
					  role="progressbar"
					  style="width: 100%">
					</div>
				  </div>
				</div>

				<div class="modal-footer justify-content-center">
				<button class="btn btn-primary px-4" data-bs-dismiss="modal">
				  Saya Mengerti
				</button>
			  </div>
			</div>
		</div>
	</div>

	<!-- Header -->
	<div class="header-section text-center">
		<div class="container">
			<h1 class="header-title">
				<i class="fas fa-satellite-dish me-2"></i>
				MONITOR TARIK EMIS - PDUM
			</h1>

			<p class="header-subtitle">
				KEMENAG KABUPATEN SUMENEP
			</p>

			<!-- Info Update -->
			<span class="badge bg-white text-primary rounded-pill px-2 px-sm-3 py-1 py-sm-2 mt-1 shadow-sm"
				  style="font-size: clamp(0.75rem, 2vw, 0.875rem);">
				<i class="fas fa-clock me-1"></i>
				<span class="d-none d-sm-inline">Data di Update</span>
				<span class="d-inline d-sm-none">Update</span>
				Tiap Pagi Pukul 06:00 WIB
			</span>
		</div>
	</div>


    <!-- Main Content -->
    <div class="main-container container">
        
        <!-- Charts Row -->
        <div class="row g-4 mb-4">

			<!-- Progres Keseluruhan -->
			<div class="col-lg-3 col-md-12">
				<div class="custom-card">
					<div class="chart-container" id="overallChartContainer">
						<div class="chart-header">
							<h6 class="chart-title">
								<i class="fas fa-chart-pie me-2 text-primary"></i>
								Progres Keseluruhan
							</h6>
							<div class="text-center">
								<div class="display-6 fw-bold text-primary mb-0" id="totalPercent">0%</div>
								<small class="text-muted">LEMBAGA SELESAI</small>
							</div>
						</div>
						<div class="chart-wrapper">
							<canvas id="overallChart"></canvas>
						</div>
					</div>
				</div>
			</div>

			<!-- Progres Validasi -->
			<div class="col-lg-3 col-md-12">
				<div class="custom-card">
					<div class="chart-container" id="validasiChartContainer">
						<div class="chart-header">
							<h6 class="chart-title">
								<i class="fas fa-check-double me-2 text-primary"></i>
								Progres Validasi
							</h6>
							<div class="text-center">
								<div class="display-6 fw-bold text-primary mb-0" id="validasiPercent">0%</div>
								<small class="text-muted">DATA TERVALIDASI</small>
							</div>
						</div>
						<div class="chart-wrapper">
							<canvas id="validasiChart"></canvas>
						</div>
					</div>
				</div>
			</div>

			<!-- Progres per Kecamatan (Diubah dari Jenjang) -->
			<div class="col-lg-6 col-md-12">
				<div class="custom-card">
					<div class="chart-container" id="kecamatanTableContainer">
						<div class="chart-header">
							<h6 class="chart-title">
								<i class="fas fa-map-marker-alt me-2 text-primary"></i>
								Progres per Kecamatan
								<span id="completeBadge" class="badge bg-success ms-2 d-none">0</span>
							</h6>
							<div class="small text-muted">
								<i class="fas fa-info-circle me-1"></i>
								<span id="totalKecamatanText">Total: 0 Kecamatan</span>
							</div>
						</div>
						<div class="kecamatan-table-container" id="kecamatanTableContent">
							<!-- Data kecamatan akan diisi oleh JavaScript -->
							<div class="kecamatan-grid" id="kecamatanGrid">
								<!-- Items akan ditambahkan di sini -->
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>


        <!-- Stats Cards Grid -->
        <div class="row g-3 mb-4" id="statsCards">
            <!-- Cards will be injected here -->
        </div>

        <!-- Table Section -->
        <div class="table-card">
            <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
                <h4 class="fw-bold mb-0"><i class="fas fa-list-alt me-2 text-primary"></i>Detail Data Madrasah</h4>
                <div class="small text-muted" id="tableInfo">
                    Memuat data...
                </div>
            </div>

            <!-- Custom Filters -->
			<div class="filter-box saas-filter">
				<div class="saas-filter-row">

					<div class="saas-item">
						<select id="filterJenjang" class="saas-select gradient-jenjang">
							<option value="">Jenjang</option>
						</select>
					</div>

					<div class="saas-item">
						<select id="filterStatus" class="saas-select gradient-status">
							<option value="">Status</option>
							<option value="SUKSES">Sudah Tarik</option>
							<option value="BELUM">Belum Tarik</option>
						</select>
					</div>

					<div class="saas-item">
						<select id="filterAlamat" class="saas-select gradient-alamat">
							<option value="">Alamat</option>
						</select>
					</div>

					<div class="saas-item">
						<select id="filterValidasi" class="saas-select gradient-validasi">
							<option value="">Validasi</option>
							<option value="SUDAH VALIDASI">Sudah Validasi</option>
							<option value="BELUM VALIDASI">Belum Validasi</option>
							<option value="PROSES">Proses</option>
							<option value="TIDAK VALID">Tidak Valid</option>
						</select>
					</div>

					<div class="saas-action">
						<button id="resetFilters" class="saas-reset-danger">
							<i class="fas fa-rotate"></i>
							<span>Reset Filter</span>
						</button>
					</div>
				</div>
			</div>


            <div class="table-responsive">
                <table id="madrasahTable" class="table table-hover align-middle w-100">
                    <thead>
                        <tr>
                            <th>NSM</th>
                            <th>Nama Madrasah</th>
                            <th>Alamat</th>
                            <th>Jml Siswa</th>
                            <th>Status</th>
                            <th>Validasi</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        &copy; By:Jalangkung Team's- Dashboard Monitoring EMIS PDUM
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

    <script>
		// ================= PESAN CUT OFF =================
		const SHOW_CUTOFF_MODAL = false; // ubah jadi true kalau mau aktif
		if (SHOW_CUTOFF_MODAL) {
			document.addEventListener("DOMContentLoaded", function () {
				const modalEl = document.getElementById('cutoffModal');
				const modal = new bootstrap.Modal(modalEl);
				const progressBar = document.getElementById('cutoffProgress');

				const duration = 5000;
				const intervalTime = 50;
				let elapsed = 0;

				modal.show();

				const interval = setInterval(() => {
					elapsed += intervalTime;
					const percent = Math.max(0, 100 - (elapsed / duration) * 100);
					progressBar.style.width = percent + '%';

					if (elapsed >= duration) {
						clearInterval(interval);
						modal.hide();
					}
				}, intervalTime);

				modalEl.addEventListener('hidden.bs.modal', () => {
					clearInterval(interval);
				});
			});
		}

		(function () {
			const targetDate = new Date("2026-01-31T23:59:59").getTime();
			const el = document.getElementById("countdownCutoff");

			function updateCountdown() {
				const now = new Date().getTime();
				const diff = targetDate - now;

				if (diff <= 0) {
					el.innerHTML = "<span class='text-danger'>WAKTU HABIS</span>";
					return;
				}

				const days = Math.floor(diff / (1000 * 60 * 60 * 24));
				const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
				const minutes = Math.floor((diff / (1000 * 60)) % 60);
				const seconds = Math.floor((diff / 1000) % 60);

				el.textContent =
					`${days} Hari ${hours} Jam ${minutes} Menit ${seconds} Detik`;
			}

			updateCountdown();
			setInterval(updateCountdown, 1000);
		})();
		
		
        // ================= CONFIGURATION =================
        const _a = '1zgWxa0CDNx1VDF0Rw1kbJSdjkrVMkzs2dtJDgpBIkPg';
        const _b = '0';
        const _c = function(x, y) { 
            return `https://docs.google.com/spreadsheets/d/${x}/gviz/tq?gid=${y}&tqx=out:json`; 
        };
        const GVIZ_URL = _c(_a, _b);

        // UPDATE: Mengambil kolom B, C, D, E, F, G (tanpa kolom A/NO)
        const QUERY = `select B,C,D,E,F,G`;

        // Global Vars
        let dataTable = null;
        let overallChart = null;
		let validasiChart = null;
        let allData = [];

        // ================= HELPERS =================
        const cleanStr = (s) => (s || '').toString().trim();
        const safeInt = (s) => {
            const n = parseInt(cleanStr(s).replace(/[^\d]/g, ''), 10);
            return isNaN(n) ? 0 : n;
        };
        const getJenjang = (nsm) => {
            const code = cleanStr(nsm).substring(0, 2);
            const map = { '10': 'RA', '11': 'MI', '12': 'MTS', '13': 'MA' };
            return map[code] || 'LAINNYA';
        };
        const isSukses = (status) => cleanStr(status).toLowerCase().includes('sudah');

		// ================= VALIDASI ENGINE =================
		const VALIDASI_STATUS = [
			{
				keywords: ['sudah divalidasi kabko'],
				label: 'SUDAH VALIDASI',
				badgeClass: 'badge-valid',
				icon: 'fa-check-circle'
			},
			{
				keywords: ['belum validasi'],
				label: 'BELUM VALIDASI',
				badgeClass: 'badge-invalid',
				icon: 'fa-times-circle'
			},
			{
				keywords: ['proses pengajuan'],
				label: 'PROSES',
				badgeClass: 'badge-pending',
				icon: 'fa-clock'
			},
			{
				keywords: ['#n/a', '', '-'],
				label: 'TIDAK VALID',
				badgeClass: 'badge-invalid',
				icon: 'fa-times-circle'
			}
		];

		const normalizeValidasi = (value) => {
			return cleanStr(value)
				.toLowerCase()
				.replace(/\s+/g, ' ')
				.trim();
		};


		const resolveValidasiStatus = (value) => {
			const val = normalizeValidasi(value);

			for (const status of VALIDASI_STATUS) {
				if (status.keywords.some(k => val.includes(k))) {
					return status;
				}
			}

			return VALIDASI_STATUS.find(s => s.label === 'TIDAK VALID');
		};


        
        // Fungsi untuk menentukan warna badge validasi
		const getValidasiBadge = (validasi) => {
			const status = resolveValidasiStatus(validasi);

			return `
				<span class="badge-validasi ${status.badgeClass}">
					<i class="fas ${status.icon} me-1"></i>${status.label}
				</span>
			`;
		};



		// Fungsi untuk mendapatkan kelas background berdasarkan persentase
		const getBackgroundClass = (percent) => {
			if (percent >= 100) return 'bg-complete';
			if (percent >= 90) return 'bg-high';
			if (percent >= 70) return 'bg-medium';
			return 'bg-low';
		};

        // Fungsi untuk mendapatkan kelas warna berdasarkan persentase
        const getPercentClass = (percent) => {
            if (percent >= 100) return 'percent-complete';
            if (percent >= 90) return 'percent-high';
            if (percent >= 70) return 'percent-medium';
            return 'percent-low';
        };

        // Fungsi untuk mendapatkan warna berdasarkan persentase
        const getColorForPercent = (percent) => {
            if (percent >= 100) return '#035c41'; // Hijau gelap
            if (percent >= 90) return '#10b981';  // Hijau
            if (percent >= 70) return '#f59e0b';  // Kuning/orange
            return '#ef4444';                     // Merah
        };

        // Fungsi untuk mendapatkan warna progress bar
        const getProgressColor = (percent) => {
            return getColorForPercent(percent);
        };


        // ================= DATA FETCHING =================
		function fetchData() {
			return new Promise((resolve, reject) => {
				const script = document.createElement('script');

				window.google = window.google || {};
				window.google.visualization = window.google.visualization || {};
				window.google.visualization.Query = window.google.visualization.Query || {};

				window.google.visualization.Query.setResponse = function (res) {
					document.head.removeChild(script);

					if (res.status === 'ok') {
						resolve(res.table);
					} else {
						reject(res.errors || 'Gagal mengambil data');
					}
				};

				script.src = `${GVIZ_URL}&tq=${encodeURIComponent(QUERY)}&cb=google.visualization.Query.setResponse`;
				script.onerror = () => reject('Network Error / Blocked');

				document.head.appendChild(script);
			});
		}

		// ================= SPLASH ANIMATION =================
		animateSplashProgress();

		function animateSplashProgress() {
			const bar = document.getElementById('splashBar');
			let progress = 0;

			const interval = setInterval(() => {
				if (progress < 85) {
					progress += Math.random() * 8;
					bar.style.width = progress + '%';
				}
			}, 200);

			window.finishSplash = function () {
				clearInterval(interval);
				bar.style.width = '100%';
			};
		}

		function hideSplashScreen() {
			const splash = document.getElementById('splashScreen');
			splash.classList.add('hidden');

			setTimeout(() => {
				splash.remove();
			}, 700);
		}

        // ================= PROCESS & RENDER =================
        async function initDashboard() {
            try {
                // Fetch data
                const rawTable = await fetchData();
				allData = rawTable.rows
					.map(r => {
						if (!r.c || r.c.length < 6) return null;

						const c = r.c;

						const statusVal = cleanStr(c[4]?.v);
						const validasiVal = cleanStr(c[5]?.v);

						return {
							nsm: cleanStr(c[0]?.v),
							nama: cleanStr(c[1]?.v),
							alamat: cleanStr(c[2]?.v),
							jml: safeInt(c[3]?.v),
							statusRaw: statusVal,
							validasi: validasiVal,
							jenjang: getJenjang(c[0]?.v),
							sukses: isSukses(statusVal)
						};
					})
					.filter(Boolean);

                if(allData.length === 0) throw new Error("Data Kosong");

                // Calculate statistics
                const stats = calculateStats(allData);
				const validasiStats = calculateValidasiStats(allData);
                const kecamatanStats = calculateKecamatanStats(allData);
                
                // Render all components
                renderCards(stats.perJenjang);
                renderOverallChart(stats.sukses, stats.belum);
				renderValidasiChart(validasiStats);
                renderKecamatanTable(kecamatanStats);
                initTable(allData);
                
                // Update table info
                document.getElementById('tableInfo').textContent = 
                    `Menampilkan ${allData.length} madrasah`;
                document.getElementById('totalKecamatanText').textContent = 
                    `Total: ${kecamatanStats.length} Kecamatan`;
				
				// Progress selesai 100%
				document.getElementById('splashBar').style.width = '100%';

				// Selesaikan progress
				if (window.finishSplash) window.finishSplash();

				// Tutup splash
				setTimeout(() => {
					hideSplashScreen();
				}, 300);

            } catch (err) {
                console.error(err);
                document.getElementById('loadingOverlay').innerHTML = `
                    <div class="text-center p-4 bg-white rounded shadow" style="max-width: 500px;">
                        <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                        <h5 class="fw-bold text-dark mb-2">Gagal Memuat Data</h5>
                        <p class="text-muted mb-3">${err.message || err}</p>
                        <button onclick="location.reload()" class="btn btn-primary">
                            <i class="fas fa-redo me-2"></i>Coba Lagi
                        </button>
                    </div>
                `;
            }
        }

        function calculateStats(data) {
            const stats = {
                total: data.length,
                sukses: data.filter(r => r.sukses).length,
                belum: data.filter(r => !r.sukses).length,
                perJenjang: {}
            };
            
            const jenjangList = ['RA', 'MI', 'MTS', 'MA', 'LAINNYA'];
            jenjangList.forEach(j => {
                const subset = data.filter(r => r.jenjang === j);
                stats.perJenjang[j] = {
                    total: subset.length,
                    sukses: subset.filter(r => r.sukses).length,
                    belum: subset.filter(r => !r.sukses).length,
                    name: j
                };
            });
            
            return stats;
        }

		function calculateKecamatanStats(data) {
			const kecamatanMap = {};
			
			// Group data by kecamatan
			data.forEach(item => {
				const kecamatan = item.alamat || 'Tidak Diketahui';
				if (!kecamatanMap[kecamatan]) {
					kecamatanMap[kecamatan] = {
						name: kecamatan,
						total: 0,
						sukses: 0,
						belum: 0
					};
				}
				
				kecamatanMap[kecamatan].total++;
				if (item.sukses) {
					kecamatanMap[kecamatan].sukses++;
				} else {
					kecamatanMap[kecamatan].belum++;
				}
			});
			
			// Convert to array and calculate percentages
			const kecamatanStats = Object.values(kecamatanMap).map(k => {
				const percent = k.total > 0 ? Math.round((k.sukses / k.total) * 100) : 0;
				return {
					...k,
					percent: percent,
					percentClass: getPercentClass(percent),
					progressColor: getProgressColor(percent),
					nameColor: getColorForPercent(percent),
					isComplete: percent === 100 // Tambahkan flag untuk kecamatan yang 100%
				};
			});
			
			// SORTING: Kecamatan 100% di atas, lalu diurutkan berdasarkan nama A-Z
			kecamatanStats.sort((a, b) => {
				// Prioritaskan yang 100%
				if (a.isComplete && !b.isComplete) return -1;
				if (!a.isComplete && b.isComplete) return 1;
				
				// Jika sama-sama 100% atau sama-sama belum 100%, urutkan berdasarkan nama A-Z
				return a.name.localeCompare(b.name);
			});
			
			return kecamatanStats;
		}

		function renderKecamatanTable(kecamatanStats) {
			const container = document.getElementById('kecamatanGrid');
			container.innerHTML = '';
			
			// Hitung jumlah kecamatan yang sudah 100%
			const completeCount = kecamatanStats.filter(k => k.isComplete).length;
			
			const completeBadge = document.getElementById('completeBadge');
			if (completeBadge) {
				if (completeCount > 0) {
					completeBadge.textContent = `${completeCount} Kecamatan 100%`;
					completeBadge.classList.remove('d-none');
				} else {
					completeBadge.classList.add('d-none');
				}
			}
			// Update teks header
			const headerText = document.querySelector('#kecamatanTableContainer .chart-header .small');
			if (headerText && headerText.querySelector('#totalKecamatanText')) {
				headerText.querySelector('#totalKecamatanText').textContent = 
					`Total: ${kecamatanStats.length} Kecamatan (${completeCount} sudah 100%)`;
			}
			
			kecamatanStats.forEach(kec => {
				const item = document.createElement('div');
				
				const percent = kec.percent || Math.round((kec.sukses / kec.total) * 100);
				const percentClass = kec.percentClass || getPercentClass(percent);
				const backgroundClass = kec.isComplete ? 'bg-complete' : getBackgroundClass(percent);
				const progressColor = kec.progressColor || getProgressColor(percent);
				const nameColor = kec.nameColor || getColorForPercent(percent);
				
				// Tambahkan icon untuk kecamatan yang sudah 100%
				const completeIcon = kec.isComplete ? 
					'<i class="fas fa-check-circle me-1" style="font-size: 0.7rem;"></i>' : '';
				
				item.className = `kecamatan-item ${backgroundClass}`;
				
				item.innerHTML = `
					<div class="kecamatan-row">
						<div class="kecamatan-left">
							<div class="kecamatan-name" style="color: ${nameColor}">
								${completeIcon}${kec.name}
							</div>
							<div class="kecamatan-count">
								${kec.sukses} dari ${kec.total}
							</div>
						</div>
						<div class="kecamatan-right">
							<div class="kecamatan-percent ${percentClass}">
								${percent}%
							</div>
						</div>
					</div>
					<div class="kecamatan-progress-container">
						<div class="kecamatan-progress-bar" 
							 style="width: ${Math.min(percent, 100)}%; background-color: ${progressColor};">
						</div>
					</div>
				`;
				
				container.appendChild(item);
			});
			
			setTimeout(() => {
				const containerElement = document.querySelector('.kecamatan-table-container');
				if (containerElement) {
					containerElement.scrollTop = 0;
				}
			}, 100);
		}
        function renderCards(data) {
            const container = document.getElementById('statsCards');
            const config = {
                'RA': { icon: 'fa-shapes', color: 'bg-icon-ra', bar: 'bg-danger' },
                'MI': { icon: 'fa-child-reaching', color: 'bg-icon-mi', bar: 'bg-primary' },
                'MTS': { icon: 'fa-book-open', color: 'bg-icon-mts', bar: 'bg-success' },
                'MA': { icon: 'fa-graduation-cap', color: 'bg-icon-ma', bar: 'bg-warning' },
                'LAINNYA': { icon: 'fa-school', color: 'bg-light', bar: 'bg-secondary' }
            };

            container.innerHTML = '';
            
            Object.keys(data).forEach(key => {
                const s = data[key];
                if (s.total === 0) return;
                
                const pct = s.total > 0 ? Math.round((s.sukses / s.total) * 100) : 0;
                const conf = config[key] || { icon: 'fa-school', color: 'bg-light', bar: 'bg-secondary' };

                const html = `
                <div class="col-md-6 col-lg-3">
                    <div class="custom-card p-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="stat-icon ${conf.color}">
                                    <i class="fas ${conf.icon}"></i>
                                </div>
                                <h5 class="fw-bold mb-1">${key}</h5>
                                <div class="text-muted small">${s.total} Lembaga</div>
                            </div>
                            <div class="text-end">
                                <div class="display-6 fw-bold text-dark">${pct}%</div>
                                <span class="badge ${pct === 100 ? 'bg-success' : 'bg-light text-dark'} rounded-pill border">
                                    ${s.sukses} Selesai
                                </span>
                            </div>
                        </div>
                        <div class="mt-3 small">
                            <div class="d-flex justify-content-between text-muted">
                                <span>Sudah: ${s.sukses}</span>
                                <span>Belum: ${s.belum}</span>
                            </div>
                        </div>
                        <div class="progress progress-micro mt-2">
                            <div class="progress-bar ${conf.bar} progress-bar-animated" 
                                 role="progressbar" 
                                 style="width: ${pct}%"></div>
                        </div>
                    </div>
                </div>`;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

		function renderOverallChart(sukses, belum) {
			const ctx = document.getElementById('overallChart');
			const total = sukses + belum;
			const pct = Math.round((sukses / total) * 100);

			// Update text dengan animasi
			animateValue('totalPercent', 0, pct, 1500);

			// Destroy existing chart
			if (overallChart) overallChart.destroy();

			// Data awal untuk animasi (0, total)
			const initialData = [0, total];
			const finalData = [sukses, belum];

			overallChart = new Chart(ctx, {
				type: 'doughnut',
				data: {
					labels: ['Sudah Tarik', 'Belum Tarik'],
					datasets: [{
						data: initialData, // Mulai dari 0
						backgroundColor: ['#10b981', '#ef4444'],
						borderWidth: 0,
						hoverOffset: 10,
						borderRadius: 8
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					cutout: '70%',
					layout: {
						padding: {
							top: 10,
							bottom: 20,
							left: 10,
							right: 10
						}
					},
					plugins: {
						legend: { 
							position: 'bottom',
							align: 'center',
							labels: { 
								usePointStyle: true,
								padding: 20,
								font: { 
									family: "'Plus Jakarta Sans', sans-serif", 
									size: 12 
								},
								boxWidth: 10,
								boxHeight: 10
							}
						},
						tooltip: {
							callbacks: {
								label: function(context) {
									const value = context.raw;
									const percentage = Math.round((value / total) * 100);
									return ` ${context.label}: ${value} (${percentage}%)`;
								}
							}
						}
					},
					// Animasi chart
					animation: {
						duration: 1500,
						easing: 'easeOutQuart'
					}
				}
			});

			// Animasi chart dari 0 ke nilai sebenarnya
			setTimeout(() => {
				overallChart.data.datasets[0].data = finalData;
				overallChart.update();
			}, 100);
		}

		function renderValidasiChart(stats) {
			const ctx = document.getElementById('validasiChart');

			const total = stats.SUDAH + stats.BELUM + stats.PROSES + stats.TIDAK_VALID;

			const pct = total > 0 
				? Math.round((stats.SUDAH / total) * 100) 
				: 0;

			animateValue('validasiPercent', 0, pct, 1500);

			if (validasiChart) validasiChart.destroy();

			validasiChart = new Chart(ctx, {
				type: 'doughnut',
				data: {
					labels: [
						'Sudah',
						'Belum',
						'Proses',
						'Tidak Valid'
					],
					datasets: [{
						data: [
							stats.SUDAH,
							stats.BELUM,
							stats.PROSES,
							stats.TIDAK_VALID
						],
						backgroundColor: [
							'#10b981',  // hijau
							'#ef4444',  // merah
							'#f59e0b',  // kuning
							'#6b7280'   // abu
						],
						borderWidth: 0,
						hoverOffset: 10,
						borderRadius: 8
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					cutout: '70%',
					layout: {
						padding: {
							top: 10,
							bottom: 20,
							left: 10,
							right: 10
						}
					},
					plugins: {
						legend: { 
							position: 'bottom',
							align: 'center',
							labels: { 
								usePointStyle: true,
								padding: 20,
								font: { 
									family: "'Plus Jakarta Sans', sans-serif", 
									size: 12 
								},
								boxWidth: 10,
								boxHeight: 10
							}
						},
					},
					animation: {
						duration: 1500,
						easing: 'easeOutQuart'
					}
				}
			});
		}


		// Fungsi helper untuk animasi angka
		function animateValue(elementId, start, end, duration) {
			const element = document.getElementById(elementId);
			if (!element) return;
			
			let startTimestamp = null;
			const step = (timestamp) => {
				if (!startTimestamp) startTimestamp = timestamp;
				const progress = Math.min((timestamp - startTimestamp) / duration, 1);
				const currentValue = Math.floor(progress * (end - start) + start);
				element.textContent = currentValue + '%';
				
				if (progress < 1) {
					window.requestAnimationFrame(step);
				}
			};
			window.requestAnimationFrame(step);
		}
		
		function calculateValidasiStats(data) {
			const stats = {
				SUDAH: 0,
				BELUM: 0,
				PROSES: 0,
				TIDAK_VALID: 0
			};

			data.forEach(d => {
				const status = resolveValidasiStatus(d.validasi);

				switch (status.label) {
					case 'SUDAH VALIDASI':
						stats.SUDAH++;
						break;
					case 'BELUM VALIDASI':
						stats.BELUM++;
						break;
					case 'PROSES':
						stats.PROSES++;
						break;
					default:
						stats.TIDAK_VALID++;
				}
			});

			return stats;
		}

		function initTable(data) {
            const tbody = document.querySelector('#madrasahTable tbody');
            
            // Populate Dropdown Jenjang
            const jenjangSet = new Set(data.map(d => d.jenjang));
            const selectJenjang = document.getElementById('filterJenjang');
            jenjangSet.forEach(j => {
                if (j) {
                    selectJenjang.insertAdjacentHTML('beforeend', `<option value="${j}">${j}</option>`);
                }
            });

			// Populate Dropdown Alamat (Diurutkan A-Z)
			const alamatList = Array.from(new Set(data.map(d => d.alamat).filter(a => a)));
			alamatList.sort(); // Urutkan dari A-Z
			const selectAlamat = document.getElementById('filterAlamat');
			alamatList.forEach(a => {
				if (a) {
					selectAlamat.insertAdjacentHTML('beforeend', `<option value="${a}">${a}</option>`);
				}
			});

            // Populate DOM dengan struktur baru
            const rowsHtml = data.map(r => `
                <tr>
                    <td class="fw-bold text-secondary font-monospace">${r.nsm}</td>
                    <td>${r.nama}</td>
                    <td>${r.alamat || '-'}</td>
                    <td class="text-end">${r.jml.toLocaleString('id-ID')}</td>
                    <td>
                        <span class="${r.sukses ? 'text-status-sukses' : 'text-status-belum'}">
                            ${r.statusRaw || '-'}
                        </span>
                    </td>
                    <td>${getValidasiBadge(r.validasi)}</td>
                </tr>
            `).join('');
            tbody.innerHTML = rowsHtml;

            // Initialize DataTables dengan responsive settings
            if (dataTable) {
                dataTable.destroy();
            }

            dataTable = $('#madrasahTable').DataTable({
                responsive: true,
                autoWidth: false,
                pageLength: 10,
                lengthMenu: [[10, 25, 50, -1], ["10", "25", "50", "Semua"]],
				dom: '<"dt-grid-container"<"dt-grid-item-left"l><"dt-grid-item-center"f><"dt-grid-item-right"B>>rt<"dt-grid-bottom"ip>',
				buttons: [
                    { 
                        extend: 'excelHtml5', 
                        className: 'btn btn-dt-excel mb-2 mb-md-0', 
                        text: '<i class="fas fa-file-excel me-1"></i> Excel',
                        title: 'Data_Madrasah_Sumenep'
                    },
                    { 
                        extend: 'pdfHtml5', 
                        className: 'btn btn-dt-pdf mb-2 mb-md-0', 
                        text: '<i class="fas fa-file-pdf me-1"></i> PDF',
                        title: 'Data_Madrasah_Sumenep'
                    },
                    { 
                        extend: 'print', 
                        className: 'btn btn-dt-print mb-2 mb-md-0', 
                        text: '<i class="fas fa-print me-1"></i> Print',
                        title: 'Data Madrasah Sumenep'
                    }
                ],
				language: {
					search: "_INPUT_",
					searchPlaceholder: "Cari NSM / Nama...",
					paginate: { 
						next: '<i class="fas fa-chevron-right"></i>', 
						previous: '<i class="fas fa-chevron-left"></i>' 
					},
					info: "Menampilkan _START_ - _END_ dari _TOTAL_ data",
					lengthMenu: "Tampilkan _MENU_ data"
				},
                columnDefs: [
                    { 
                        targets: [0, 3, 4, 5], // NSM, Jml Siswa, Status, Validasi - rata tengah
                        className: "text-center align-middle"
                    },
                    { 
                        targets: [1, 2], // Nama Madrasah dan Alamat - rata kiri
                        className: "align-middle"
                    },
                    { responsivePriority: 1, targets: 1 }, // Nama Madrasah
                    { responsivePriority: 2, targets: 2 }, // Alamat
                    { responsivePriority: 3, targets: 4 }, // Status
                    { responsivePriority: 4, targets: 5 }, // Validasi
                    { responsivePriority: 5, targets: 0 }, // NSM
                    { responsivePriority: 6, targets: 3 }, // Jml Siswa
                    { className: "text-nowrap", targets: [0, 3, 4, 5] }
                ]
            });

            // Custom Filtering Logic
            $.fn.dataTable.ext.search.push((settings, data, dataIndex) => {
                const fJenjang = $('#filterJenjang').val();
                const fAlamat = $('#filterAlamat').val();
                const fStatus = $('#filterStatus').val();
				const fValidasi = $('#filterValidasi').val();

                // Get the row node
                const rowNode = dataTable.row(dataIndex).node();
                if (!rowNode) return true;
                
                // Extract data from row
                const rowNSM = $(rowNode).find('td:first-child').text().trim();
                const rowJenjang = getJenjang(rowNSM);
                const rowAlamat = $(rowNode).find('td:nth-child(3)').text().trim();
                const isSuksesRow = $(rowNode).find('.text-status-sukses').length > 0;
                const statusCheck = isSuksesRow ? 'SUKSES' : 'BELUM';

                if (fJenjang && rowJenjang !== fJenjang) return false;
                if (fAlamat && rowAlamat !== fAlamat) return false;
                if (fStatus && statusCheck !== fStatus) return false;
				if (fValidasi) {
					const validasiCell = $(rowNode).find('td:nth-child(6)').text().trim();
					if (validasiCell !== fValidasi) return false;
				}
                return true;
            });

            // Event Listeners
            $('#filterJenjang, #filterAlamat, #filterStatus, #filterValidasi').on('change', function() {
                dataTable.draw();
                updateTableInfo();
            });

            $('#resetFilters').on('click', function() {
                $('#filterJenjang').val('');
                $('#filterAlamat').val('');
                $('#filterStatus').val('');
				$('#filterValidasi').val('');
                dataTable.search('').draw();
                updateTableInfo();
            });

            // Update table info on page change
            dataTable.on('draw', updateTableInfo);

            function updateTableInfo() {
                const filteredCount = dataTable.rows({ search: 'applied' }).count();
                document.getElementById('tableInfo').textContent = 
                    `Menampilkan ${filteredCount} dari ${allData.length} madrasah`;
            }
        }

        // Handle window resize for charts
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                if (overallChart) overallChart.resize();
                if (validasiChart) validasiChart.resize();
            }, 250);
        });

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', initDashboard);

    </script>
</body>
</html>
